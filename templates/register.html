<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>注册</title>
    <link rel="stylesheet" href="https://unpkg.com/mdui@1.0.2/dist/css/mdui.min.css">
    <link rel="stylesheet" href="/resources/css/register.css">
</head>

<body>
<div id="container" class="mdui-container mdui-shadow-12">
    <div id="description" class="mdui-row">
        <h1 class="mdui-text-center mdui-col-xs-12">
            客户端注册
        </h1>
    </div>
    <div id="input-bar">
        <div class="mdui-textfield mdui-textfield-floating-label mdui-row mdui-col-xs-12">
            <label class="mdui-textfield-label">电子邮箱</label>
            <input id="email" class="mdui-textfield-input" type="email" required />
            <div class="mdui-textfield-error">邮箱格式错误</div>
        </div>
        <div class="mdui-textfield mdui-textfield-floating-label mdui-row mdui-col-xs-12">
            <label class="mdui-textfield-label">服务器名</label>
            <input id="servername" class="mdui-textfield-input" type="text" required />
            <div class="mdui-textfield-error">服务器名不能为空</div>
        </div>
        <div
                class="cf-turnstile"
                data-sitekey="0x4AAAAAAAknWA8vGmV7UUkE"
                data-callback="javascriptCallback"
        ></div>
        <div class="mdui-row mdui-col-xs-12">
            <button id="clearButton" class="mdui-btn mdui-ripple">清空</button>
            <button id="submitButton" class="mdui-btn mdui-color-theme-accent mdui-ripple">提交</button>
        </div>
    </div>
</div>
</body>
<script src="https://unpkg.com/mdui@1.0.2/dist/js/mdui.min.js"></script>
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('clearButton').addEventListener('click', function() {
            document.getElementById('email').value = '';
            document.getElementById('servername').value = '';
        });

        document.getElementById('submitButton').addEventListener('click', function(event) {
            event.preventDefault();

            var serverName = document.getElementById('servername').value;
            if (serverName.length > 20) {
                mdui.alert('服务器名过长，请重新输入', '错误');
                return;
            }

            var email = document.getElementById('email').value;
            var turnstileResponse = document.querySelector('input[name="cf-turnstile-response"]').value;

            if (!turnstileResponse) {
                mdui.alert('请完成验证码', '错误');
                return;
            }


            // 提交注册信息
            axios.post('/api/register', {
                email: email,
                server_name: serverName,
                cf_token: turnstileResponse
            })

                .then(function (response) {
                    mdui.alert("提交成功，您的分数是" + JSON.parse(response.data.score) + "分\n答题信息："+"\n玩家id:"+this.player_id+"\n答题时间戳:"+Date.now()+"\n是否及格:"+response.data.pass)
                    location.reload()
                })
                .catch(function (error) {
                    console.log(error);
                    mdui.alert("提交失败，请联系开发者处理" + error)
                });
    });

    function javascriptCallback(token) {
        var input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'cf-turnstile-response';
        input.value = token;
        document.getElementById('input-bar').appendChild(input);
    }
    });
</script>

</html>
